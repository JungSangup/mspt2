# Docker & Kubernetes 노트 (MSP T2 23-2차) (●'◡'●)
## Q&A

### Docker

- App별로 다른 OS를 사용한다면, OS를 공유하는 컨테이너는 사용 못하는건가요?
  - 아니오, 그렇지 않습니다.
  - OS Kernel 을 공유하고, 배포판별로 달라지는 건 컨테이너 이미지를 만들 때 다른 배포판을 사용해서 만들 수 있습니다.
  - 예를들어, 같은 Kernel위에서 Ubuntu와 CentOS 기반의 애플리케이션을 모두 실행할 수 있습니다.

- OS가 다양하고 이미지에 포함된 것 같은데, OS가 다양하면 그만큼 인프라 자원을 사용하게 되나요?
  - 인프라 자원은 한정적이기 때문에 Control group을 이용하여 자원을 적절히 나눠서 쓰게 됩니다.

- Hypervisor라는 레이어는 어떤 역할을 해주는건가요?
  - 가상머신(Virtual machine)을 제공해주기 위해서 사용되는 가상화솔루션 입니다.
  - 

- 코드와 종속성을 패키징 하는 소프트웨어의 표준 단위입니다. 에서 `종속성`은 무엇을 의미하나요?
  - App. 을 위한 코드도 필요하지만, 여러가지 종속된 라이브러리나 오픈소스 패키지들이 필요할 수 있습니다. 그 부분을 모두 컨테이너에 담는다는 의미입니다.
  - 예를들어 A 시스템이 Log4j를 이용한다면 그 부분도 패키징한다는 의미입니다.

- Container 와 VM 비교에서 VM이 격리/보안 측면에서 더 좋다고 했는데, 어떤 부분이 더 좋은건가요?
  - Volume파트를 보시면 좀 더 도움이 될 것 같습니다.
  - Container는 Host의 파일시스템이나 네트워크를 직접 사용하는 방법을 제공합니다. (잘 못 사용하면, 다른 컨테이너나 Host의 프로세스에 영향을 줄 수 있습니다.)
  - VM은 OS가 분리되어 있기 때문에, 위와같은 위험성은 상대적으로 적습니다.

- [Killercoda](https://killercoda.com/) 에서 포트접속 방법 다시 알려주세요.
  - 우측상단 메뉴 > Traffic/Ports > Custom Ports에 접속하려는 포트 설정 후 `Access`버튼 클릭

![](./img/killercoda_port_1.png)
![](./img/killercoda_port_2.png)

- Registry를 로컬 서버에 구축할 수 있는건가요?
  - 네, 가능합니다.
  - [Docker Registry - Basic commands](https://docs.docker.com/registry/#basic-commands) 의 **Start your registry** 부분 참고하세요.
  - 위 방법 말고도, Private registry를 구축하는 다양한 방법이 있습니다. (e.g. [Harbor](https://goharbor.io/) 와 같은 솔루션을 사용)

- 만약 서로다른 레이어인데 같은 경로의 같은 이름의 파일이 있다면 어떻게 되나요?
  - 위의 레이어가 우선합니다.

- Container는 Instance라고 했는데, 해당 레이어(Container layer)의 내용은 휘발성인가요?
  - 네, 맞습니다.
  - 그래서 뒤에 Volume이라는 걸 배울 예정입니다. (휘발성 레이어의 내용을 기록하는 방법)

- 해당 Layer가 이미 Image로 포함되었는데, 사라지지는 않겠죠?
  - 네, Image레이어는 Read only이고 사라지지 않습니다.
  - 단, 컨테이너가 실행되는 동안에 Container layer에서 Image layer의 내용을 삭제(실제로 삭제되지은 않고, 위의 레이어에서 삭제처리만 함)할 수는 있습니다.
  - 위의 경우에도 같은 Image layer를 사용하는 다른 컨테이너에서는 삭제되지 않은 상태로 사용 가능합니다.

- 이미지의 레이어들 중 가장 위의 0B 레이어는 어떤 의미인가요?
  - 교재 그림의 가장 위 레이어를 말씀하시는 것 같습니다.
  - 특별한 의미는 없고, 예시인 것 같습니다.
  - 보통은 각 레이어마다 파일들이 존재하기 때문에 어느정도의 사이즈를 가지고 있습니다.

- LB로 컨테이너를 여러개 실행하면 컨테이너 레벨에서 레이어를 쌓은건 복사 안되고, 이미지 단계에서 쌓은 레이어가 여러개가 되는건가요?
  - Image layer들의 내용은 공유를 하고(같은 파일시스템의 파일을 사용하고), 각 컨테이너의 레이어만 별도로 가지게 됩니다.

- 컨테이너가 여러개 있다면 정합성 문제는 없나요?
  - 그런 문제들은 애플리케이션에서 해결해야 합니다. (자동으로 동기화 되지는 않습니다.)
  - 예를들어 DB 라면 각 컨테이너별로 데이터를 replication해야 합니다.

- Base image는 누군가 만들어놓은 거라고 했는데, 공유된것만 쓰나요? 내가 만들어둔걸 쓸 수도 있나요?
  - 다 가능합니다.
  - [Docker Hub](https://hub.docker.com/)와 같은곳에 공개된 Image를 Base로 할 수도 있고, Private registry에 있는 우리 팀의 이미지를 Base로 할 수도 있습니다.
  - 나만의 이미지를 만들어서, 그걸 Base로 할 수도 있습니다. (Registry에 공유하지 않고)

- Run을 실행하는 시점에 Container layer가 daemon에 의해서 생성된다고 보며 될까요?
  - 네, 맞습니다.

- 동일한 실행 파일(이미지)을 detatched와 foreground모드로 다 실행 가능한가요?
  - 네, 대부분 가능합니다.
  - 보통 Web application같은 경우는 detached 형태로 실행하는 경우가 많습니다. 하지만, foreground모드로 실행하고 shell 명령어를 이용해서 개발단계나 디버깅 시 살펴볼 수 있습니다.
  
- docker stop이나 run명령어 실행 시 특정 컨테이너나 이미지를 지정하지 않으면 모든 이미지에 적용되나요?
  - 아니오, 그렇지 않습니다.
  - 컨테이너를 조작하는 명령어는 뒤에 컨테이너를, 이미지를 조작하는 명령어는 뒤에 이미지를 주도록 되어있습니다. 지정하지 않으면 에러가 발생합니다.

- Attach와 exec의 차이는 attach는 컨테이너 내부로 진입(attach)하는 것이고, exec는 바로 명령어를 실행시키는건가요?
  - 네, 맞습니다.
  - 예를들어 아래와 같은것이 가능합니다. (docker exec my-ubuntu bash -c "cat /etc/os-release")

```bash
ubuntu@ip-10-0-3-56:~$ docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS         PORTS     NAMES
e0d3f83c223b   ubuntu    "bash"    6 seconds ago   Up 6 seconds             my-ubuntu
ubuntu@ip-10-0-3-56:~$ docker exec my-ubuntu bash -c "cat /etc/os-release"
PRETTY_NAME="Ubuntu 22.04.1 LTS"
NAME="Ubuntu"
VERSION_ID="22.04"
VERSION="22.04.1 LTS (Jammy Jellyfish)"
VERSION_CODENAME=jammy
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=jammy
```
